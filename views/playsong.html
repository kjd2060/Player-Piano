<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<title>Current files</title>
    <script src="js/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="js/bootstrap-slider.js"></script>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/bootstrap-slider.min.css">
    <link rel="stylesheet" href="css/list.css">
	
</head>
<body style="margin-top:2%">
<div class="container-fluid">
    <div class="row">
        <div class="col-xs-6 col-xs-offset-3 text-center">
            <h1>{{fn}}</h1>
			<p hidden>{{fileName}}</p>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-2 col-xs-offset-2 text-center">
            <button class="btn btn-primary btn-large" onclick="pause();">
                <span class="glyphicon glyphicon-pause" aria-hidden="true"></span>
            </button>
        </div>
        <div class="col-xs-4 text-center">
            <button class="btn btn-primary btn-large" onclick="play();">
                <span class="glyphicon glyphicon-play" aria-hidden="true"></span>
            </button>
        </div>
        <div class="col-xs-2 text-center">
            <button class="btn btn-primary btn-large" onclick="stop();">
                <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            </button>
        </div>
    </div>
    <div class="row" style="padding-top:3%">
        <div class="col-xs-8 col-xs-offset-2 text-center">
            <h3>Tempo:</h3>
            <b>0x&nbsp&nbsp&nbsp</b><input id="slider" data-slider-id='slider-data' type="text" data-slider-min="0" data-slider-max="5" data-slider-step=".1" data-slider-value="1"/><b>5x</b>
        </div>
		<div class="col-xs-8 col-xs-offset-2 text-center">
            <h3>Time:</h3>
            <b id="songCurrentTime">0:00&nbsp&nbsp</b><input id="time-slider" data-slider-id='time-data' type="text" data-slider-min="0" data-slider-max="{{songEndSeconds}}" data-slider-step="1" data-slider-value="0" data-slider-handle="custom" data-slider-tooltip="hide"/><b>{{songEnd}}</b>
        </div>
    </div>
</div>
<div>
    <!-- I can't remember why we were using this so I'm commenting it out since visually it's bad
        <img src="images/grand_staff.PNG" alt="Grand Staff -> Midi" style="vertical-align: middle"/>-->
    <div class="col-xs-8 col-xs-offset-2 text-center" id="tracks_checkboxes">
        <br/>
        <br/>
        <br/>
        <h3>Tracks to play:</h3>
    <ul style="list-style: none;"">
        {{#tracks}}
            <li><input type="checkbox" value = "{{trackName}}" onclick="updateTracks(this);">&nbsp;{{trackName}}</li>
        {{/tracks}}
    </ul>
</div>
</div>
<script>
    $(document).ready(function() {
        $('#slider').slider({
            formatter: function(value) {
                return 'Current value: ' + value;
            }
        });
    });

	$(document).ready(function() {
        $('#time-slider').slider({
            formatter: function(value) {
                /*pause();
                var timeVal = document.getElementById("time-slider").getAttribute("data-slider-value");
                var minutes = Math.floor(timeVal / 60);
                var seconds = timeVal - minutes * 60;
                var newtime = "" + minutes + ":" + (seconds < 10 ? "0" : "");
                newtime = newtime + seconds;
                newtime = newtime + "&nbsp;&nbsp;";
                document.getElementById("songCurrentTime").innerHTML = newtime;
                playFromTime(timeVal);*/
                return 'Current value: ' + value;
            }
        });
        // stopTimer();
        // do math to figure out new time
        // startTimer();
    });
	
    function pause() {
        $.post('/pause', function(data) {
            console.log(data);
        });
    }

    function play() {
        var tempoMod = $('#slider').slider('getValue');
        $.post('/start', {
                            tempo : tempoMod,
                            time : 0
                        },
                        function(data) {
                            console.log(data);
                        }
        );
        startTimer();
    }

    function playFromTime(time){
        var tempoMod = $('#slider').slider('getValue');
        $.post('/start', {
                            tempo : tempoMod,
                            time : time
                        },
                        function(data) {
                            console.log(data);
                        }
        );
        startTimer();
    }

    function stop() {
        $.post('/stop', function(data) {
            console.log(data);
        });
        stopTimer();
    }
    function updateTracks(data){
        if(data.checked){
            value = data.getAttribute("value");
            $.post('/updateTracks', {request_data : value}, function(data){

                console.log(data);
            })
        }
    }

    var myVar = null;
    
    function startTimer(){
        myVar = setInterval(myTimer, 1000);
    }
    
    function stopTimer(){
        if(myVar != null){
            clearInterval(myVar);
        }
    }

    function myTimer(){
        var time = document.getElementById("songCurrentTime").innerHTML;
        time = time.replace(/\D/g, '');
        //time = time.replace('<!--0:00-->&nbsp;&nbsp;', '');
        console.log(time)
        var timeInt = parseInt(time);
        timeInt += 1;
        var minutes = Math.floor(timeInt / 60);
        var seconds = timeInt - minutes * 60;
        var newtime = "" + minutes + ":" + (seconds < 10 ? "0" : "");
        newtime = newtime + seconds;
        newtime = newtime + "&nbsp;&nbsp;";
        document.getElementById("songCurrentTime").innerHTML = newtime;
        console.log(newtime);
    }

    function str_pad_left(string, pad, length){
        return (new Array(length+1).join(pad)+string).slice(-length);
    }
</script>
</body>
</html>